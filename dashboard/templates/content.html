{% extends "base.html" %}
{% block active_page %}content{% endblock %}
{% block content %}
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f5f6f8;
  }

  .container {
    padding: 30px;
  }

  .bg-blk {
    background: #000;
    padding: 20px 30px;
    margin-left: -28px;
    margin-right: -28px;
    color: white;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    margin-bottom: 25px;
  }

  .bg-blk h1 {
    font-size: 26px;
    font-weight: bold;
    margin: 0;
  }

  .tabs {
    display: flex;
    gap: 20px;
    margin-bottom: 25px;
  }

  .tab {
    background: #000;
    border: none;
    color: white;
    font-size: 15px;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.2s;
  }

  .tab:hover {
    background: #222;
  }

  .tab.active {
    background: #444;
    font-weight: bold;
  }

  .add-btn {
    background: #000;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 16px;
    cursor: pointer;
    margin-bottom: 15px;
    transition: background 0.2s;
  }

  .add-btn:hover {
    background: #333;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  }

  th, td {
    text-align: left;
    padding: 14px;
    font-size: 14px;
  }

  th {
    background: #f2f2f2;
    color: #555;
    font-weight: bold;
  }

  tr:nth-child(even) {
    background: #fafafa;
  }

  td a, td button {
    font-size: 13px;
    color: #000;
    background: none;
    border: none;
    cursor: pointer;
    text-decoration: underline;
    margin-right: 10px;
  }

  td a:hover, td button:hover {
    color: #444;
  }

  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .modal.active {
    display: flex;
  }

  .modal-content, .modal form {
    background: #fff;
    width: 500px;
    max-height: 85vh;
    overflow-y: auto;
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  }

  .modal h2 {
    margin-top: 0;
    font-size: 20px;
    margin-bottom: 20px;
    color: #111;
  }

  input[type="text"], textarea, input[type="file"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: #f9f9f9;
    font-size: 14px;
    margin-bottom: 15px;
  }

  textarea {
    resize: vertical;
    min-height: 80px;
  }
.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}
  .modal button {
    background: #000;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 18px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .modal button:hover {
    background: #333;
  }

  .modal button[type="button"] {
    background: #ccc;
    color: #000;
  }

  .modal button[type="button"]:hover {
    background: #bbb;
  }
</style>

<body>
  <section class="bg-blk">
    <div class="container">
      <h1>Content Management</h1>
    </div>

  <div class="content-container">
    <div class="tabs">
      <button class="tab active" data-tab="files">Files</button>
      <button class="tab" data-tab="lessons">Lessons</button>
    </div>
  </section>

    <!-- FILES TAB -->
    <div id="files" class="tab-content active">
      <button class="add-btn" onclick="openModal('addFileModal')">+ Add File</button>
      <table>
        <tr>
          <th>Title</th>
          <th>Description</th>
          <th>File</th>
          <th>Actions</th>
        </tr>
        {% for file in files %}
        <tr>
          <td>{{ file.title }}</td>
          <td>{{ file.description }}</td>
          <td><a href="{{ file.file.url }}" target="_blank">View</a></td>
          <td>
            <button onclick="openEditFileModal('{{ file.id }}', '{{ file.title }}', '{{ file.description }}')">Edit</button>
            <a href="{% url 'delete_file' file.id %}" onclick="return confirm('Are you sure you want to delete this file?')">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="4">No files yet.</td></tr>
        {% endfor %}
      </table>
    </div>

    <!-- LESSONS TAB -->
    <div id="lessons" class="tab-content">
      <button class="add-btn" onclick="openModal('addLessonModal')">+ Add Lesson</button>
      <table>
        <tr>
          <th>Title</th>
          <th>Subtitle</th>
          <th>Message</th>
          <th>Actions</th>
        </tr>
        {% for lesson in lessons %}
        <tr>
          <td>{{ lesson.title }}</td>
          <td>{{ lesson.subtitle }}</td>
          <td>{{ lesson.message|truncatewords:15 }}</td>
          <td>
            <button onclick="openEditLessonModal('{{ lesson.id }}', '{{ lesson.title }}', '{{ lesson.subtitle }}', '{{ lesson.message }}')">Edit</button>
            <a href="{% url 'delete_lesson' lesson.id %}" onclick="return confirm('Delete this lesson?')">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="4">No lessons yet.</td></tr>
        {% endfor %}
      </table>
    </div>
  </div>

  <!-- MODALS -->
  <div id="addFileModal" class="modal">
    <form action="{% url 'add_file' %}" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <h2>Add File</h2>
      {{ file_form.as_p }}
      <button type="submit">Save</button>
      <button type="button" onclick="closeModal('addFileModal')">Cancel</button>
    </form>
  </div>

  <div id="editFileModal" class="modal">
    <form id="editFileForm" method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <h2>Edit File</h2>
      <label>Title</label>
      <input type="text" name="title" id="editFileTitle">
      <label>Description</label>
      <textarea name="description" id="editFileDescription"></textarea>
      <input type="file" name="file">
      <button type="submit">Update</button>
      <button type="button" onclick="closeModal('editFileModal')">Cancel</button>
    </form>
  </div>

  <div id="addLessonModal" class="modal">
    <form action="{% url 'add_lesson' %}" method="post">
      {% csrf_token %}
      <h2>Add Lesson</h2>
      {{ lesson_form.as_p }}
      <button type="submit">Save</button>
      <button type="button" onclick="closeModal('addLessonModal')">Cancel</button>
    </form>
  </div>

  <div id="editLessonModal" class="modal">
    <form id="editLessonForm" method="post">
      {% csrf_token %}
      <h2>Edit Lesson</h2>
      <label>Title</label>
      <input type="text" name="title" id="editLessonTitle">
      <label>Subtitle</label>
      <input type="text" name="subtitle" id="editLessonSubtitle">
      <label>Message</label>
      <textarea name="message" id="editLessonMessage"></textarea>
      <button type="submit">Update</button>
      <button type="button" onclick="closeModal('editLessonModal')">Cancel</button>
    </form>
  </div>

  <script>
    const tabs = document.querySelectorAll(".tab");
    const contents = document.querySelectorAll(".tab-content");
    tabs.forEach(t => t.addEventListener("click", () => {
      tabs.forEach(b => b.classList.remove("active"));
      contents.forEach(c => c.classList.remove("active"));
      t.classList.add("active");
      document.getElementById(t.dataset.tab).classList.add("active");
    }));

    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    function openEditFileModal(id, title, desc) {
      document.getElementById("editFileForm").action = `/edit-file/${id}/`;
      document.getElementById("editFileTitle").value = title;
      document.getElementById("editFileDescription").value = desc;
      openModal('editFileModal');
    }

    function openEditLessonModal(id, title, subtitle, msg) {
      document.getElementById("editLessonForm").action = `/edit-lesson/${id}/`;
      document.getElementById("editLessonTitle").value = title;
      document.getElementById("editLessonSubtitle").value = subtitle;
      document.getElementById("editLessonMessage").value = msg;
      openModal('editLessonModal');
    }
  </script>
{% endblock %}
