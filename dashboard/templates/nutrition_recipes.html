{% extends "base.html" %}
{% block content %}
<style>
  body { margin: 0; font-family: Arial, sans-serif; color: #000; }
  .bg-black { background-color: #000; color: #fff; }
  .bg-black a { color: #bbb; }
  .container { padding: 30px; }
  h1 { margin: 0; font-size: 28px; }

  .btn {
    padding: 10px 16px; background: #000; color: #fff;
    border: none; border-radius: 6px; cursor: pointer; font-size: 14px;
  }

  .table {
    width: 100%; background: white; border-radius: 10px;
    border-collapse: collapse; overflow: hidden;
  }
  .table th, .table td { text-align: left; padding: 14px; font-size: 14px; }
  .table th { color: #666; }
  .empty { text-align: center; padding: 50px 20px; color: #555; font-size: 14px; }

  /* Custom modal (renamed to avoid Bootstrap conflicts) */
  .x-modal.modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.5);
    display: none; align-items: center; justify-content: center; z-index: 1055;
  }
  .x-modal.active { display: flex; }
  .x-modal__content {
    background: #fff; width: 600px; max-height: 90vh; overflow-y: auto;
    border-radius: 20px; padding: 30px; position: relative;
  }
  .x-modal__content h2 { margin-top: 0; font-size: 20px; }

  .upload { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
  .upload-box {
    width: 60px; height: 60px; border: 1px dashed #aaa; border-radius: 10px;
    display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer;
  }
  .stats { font-size: 14px; margin-bottom: 20px; }
  .stats span { margin-right: 15px; }
  .input-field, .textarea, select {
    width: 100%; padding: 12px; margin-top: 10px; margin-bottom: 20px;
    border-radius: 8px; border: 1px solid #ccc; background: #f9f9f9; font-size: 14px;
  }
  .footer { display: flex; justify-content: flex-end; gap: 15px; margin-top: 20px; }
  .cancel { background: transparent; border: none; font-size: 14px; cursor: pointer; }
  .submit { background: #000; color: #fff; border: none; padding: 10px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; }
</style>

<!-- Nutrition Section -->
<section class="bg-black text-white py-8 px-6">
  <h1 class="text-4xl font-bold">Nutrition</h1>
  <div class="flex space-x-8 mt-4 text-gray-300">
    <a href="{% url 'nutrition_recipes' %}" class="hover:text-white {% if active_tab == 'recipes' %}border-b-2 border-white text-white{% endif %}">Recipes</a>
    <a href="{% url 'nutrition' %}" class="hover:text-white {% if active_tab == 'ingredients' %}border-b-2 border-white text-white{% endif %}">Ingredients</a>
    <a href="{% url 'nutrition_templates' %}" class="hover:text-white {% if active_tab == 'templates' %}border-b-2 border-white text-white{% endif %}">Templates</a>
  </div>
</section>

<div class="container">
  <div class="recipes-topbar" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    <div style="display:flex; gap:10px;">
      <input type="text" placeholder="Search" style="padding:8px; border:1px solid #ccc; border-radius:6px;">
      <select style="padding:8px; border:1px solid #ccc; border-radius:6px;">
        <option>Tag</option>
        <option>Breakfast</option>
        <option>Lunch</option>
        <option>Dinner</option>
        <option>Snack</option>
      </select>
    </div>
    <button class="btn" data-modal-open="#recipeModal">Create a Recipe</button>
  </div>

  {% if meals %}
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Meal Type</th>
        <th>Protein (g)</th>
        <th>Carbs (g)</th>
        <th>Fat (g)</th>
        <th>Calories</th>
        <th>Prep Time</th>
      </tr>
    </thead>
    <tbody>
      {% for meal in meals %}
      <tr>
        <td>
          <strong>{{ meal.name }}</strong>
          <div style="font-size:12px; color:#666;">{{ meal.description|truncatewords:8 }}</div>
        </td>
        <td class="capitalize">{{ meal.meal_type }}</td>
        <td>{{ meal.protein }}g</td>
        <td>{{ meal.carbs }}g</td>
        <td>{{ meal.fats }}g</td>
        <td>{{ meal.calories }}</td>
        <td>{% if meal.preparation_time %}{{ meal.preparation_time }} min{% else %}-{% endif %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <table class="table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Language</th>
        <th>Library</th>
        <th>Macro split</th>
        <th>Calories</th>
        <th>Time</th>
        <th>Meal type</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td colspan="7" class="empty">
          <div style="font-size:24px;">‚ùì</div>
          <strong>No recipes found</strong>
          <p>Recipes are the foundation of your nutrition plans. Mark favorites to see them here.</p>
        </td>
      </tr>
    </tbody>
  </table>
  {% endif %}
</div>

<!-- Modal -->
<div id="recipeModal" class="x-modal modal-overlay">
  <div class="x-modal__content" role="dialog" aria-modal="true" aria-labelledby="recipeTitle">
    <button type="button" aria-label="Close" data-modal-close="#recipeModal"
            style="position:absolute; right:16px; top:16px; background:none; border:none; font-size:18px; cursor:pointer;">√ó</button>

    <h2 id="recipeTitle">Create recipe</h2>

    <div class="upload">
      <div class="upload-box">‚¨Ü</div>
      <input type="text" placeholder="Recipe name" class="input-field">
    </div>

    <div class="stats">
      <span style="color:#e74c3c;">Protein 0g</span>
      <span style="color:#27ae60;">Carbs 0g</span>
      <span style="color:#2980b9;">Fat 0g</span>
    </div>

    <input type="text" placeholder="Search ingredients and spices" class="input-field">
    <input type="text" placeholder="Ingredients will show here" class="input-field">

    <div style="font-size:14px; margin-bottom:20px;">
      üîì Flexible ingredient amounts <br>
      <small>Calories and ingredient amounts will scale to fit clients calories intake</small>
    </div>

    <textarea class="textarea" rows="4" placeholder="Instructions"></textarea>

    <div style="display:flex; gap:15px;">
      <input type="text" placeholder="Preparation time (min)" class="input-field">
      <input type="text" placeholder="Cooking time (min)" class="input-field">
    </div>

    <div style="display:flex; gap:15px;">
      <select class="input-field"><option>Preparation time</option></select>
      <select class="input-field"><option>Kind</option></select>
      <select class="input-field"><option>English (US)</option></select>
    </div>

    <div class="footer">
      <button type="button" class="cancel" data-modal-close="#recipeModal">Cancel</button>
      <button type="button" class="submit">Submit</button>
    </div>
  </div>
</div>

<script>
  // Open / close modal by data attributes
  document.addEventListener('click', (e) => {
    const opener = e.target.closest('[data-modal-open]');
    if (opener) {
      const sel = opener.getAttribute('data-modal-open');
      const el = document.querySelector(sel);
      if (el) el.classList.add('active');
    }

    const closer = e.target.closest('[data-modal-close]');
    if (closer) {
      const sel = closer.getAttribute('data-modal-close');
      const el = document.querySelector(sel);
      if (el) el.classList.remove('active');
    }

    // Click on overlay closes (needs modal-overlay on the wrapper)
    if (e.target.classList?.contains('modal-overlay')) {
      e.target.classList.remove('active');
    }
  });

  // ESC closes any open modal
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      document.querySelectorAll('.x-modal.active').forEach(m => m.classList.remove('active'));
    }
  });
</script>
{% endblock %}