{% extends "base.html" %}
{% load form_extras %}
{% block content %}
<script src="https://cdn.tailwindcss.com"></script>

<!-- Header -->
<section class="bg-black text-white py-8 px-6">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-4xl font-bold">Workouts</h1>
      <div class="flex gap-8 mt-4 text-gray-300">
        <a href="{% url 'workouts' %}?tab=templates"
           class="hover:text-white {% if active_tab == 'templates' %}border-b-2 border-white text-white{% endif %}">
          Templates
        </a>
        <a href="{% url 'workouts' %}?tab=exercises"
           class="hover:text-white {% if active_tab == 'exercises' %}border-b-2 border-white text-white{% endif %}">
          Exercises
        </a>
      </div>
    </div>
   
  </div>
</section>

<main class="bg-gray-50 px-6 md:px-8 py-8 min-h-screen">
  {% if active_tab == 'templates' %}
   <a href="{% url 'workouts' %}?tab=templates&new=1&name=New%20Program"
       class="bg-white text-black px-4 py-2 rounded-lg text-sm hover:bg-gray-200">
      Create template
    </a>
  <div class="grid grid-cols-1  gap-6">
    <!-- Left list -->
    <div class="lg:col-span-1">
      <div class="flex items-center justify-between mb-3">
        <p class="text-sm font-semibold">Showing {{ templates_count }} templates</p>
        <form method="get" class="flex items-center gap-2">
          <input type="hidden" name="tab" value="templates">
          <div class="relative">
            <input type="text" name="q_tpl" value="{{ q_tpl }}" placeholder="Search"
                   class="pl-9 pr-3 py-2 border rounded-lg text-sm bg-white" />
            <svg class="w-4 h-4 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-4.3-4.3M10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16z"/>
            </svg>
          </div>
          <button class="px-3 py-2 border rounded text-sm">Filter</button>
        </form>
      </div>

      <div class="bg-white rounded-xl shadow-sm border overflow-hidden">
        <table class="w-full text-left">
          <thead class="bg-gray-50 border-b">
            <tr class="text-sm">
              <th class="py-3 px-4 font-semibold">Name</th>
              <th class="py-3 px-4 font-semibold">Sessions</th>
            </tr>
          </thead>
          <tbody>
            {% if templates %}
              {% for t in templates %}
              <tr class="border-b hover:bg-gray-50">
                <td class="py-3 px-4">
                <a href="{% url 'workout_template_detail' t.first_id %}" class="block font-medium hover:underline">
  {{ t.name }}
</a>
                </td>
                <td class="py-3 px-4 text-sm">{{ t.sessions }}</td>
              </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="2" class="py-10 text-center text-gray-500">No templates yet</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

        <!-- Session tabs -->
        {% if sessions %}
        <div class="flex ">
          {% for s in sessions %}
            <a href="{% url 'workouts' %}?tab=templates&pk={{ s.pk }}"
               class="px-3 py-1.5 rounded border text-sm hover:bg-gray-50 {% if editor_workout and s.pk == editor_workout.pk %}bg-gray-100{% endif %}">
              Session {{ forloop.counter }}
            </a>
          {% endfor %}
        </div>
        {% endif %}

       
    </div>
  </div>
  {% endif %}

  {% if active_tab == 'exercises' %}
    {# Render your exercises table here like before #}
  {% endif %}
</main>

<script>
  // Formset add/remove
  (function(){
    const rows = document.getElementById('rows');
    if (!rows) return;
    const tpl = document.getElementById('empty-row');
    const total = document.querySelector('input[name$="-TOTAL_FORMS"]');

    function renumber() {
      let i = 1;
      rows.querySelectorAll('.ex-row').forEach(r => {
        if (!r.classList.contains('hidden')) {
          const order = r.querySelector('input[name$="-order"]');
          if (order) order.value = i++;
        }
      });
    }

    function bindRemove(btn) {
      btn.addEventListener('click', () => {
        const row = btn.closest('.ex-row');
        const del = row.querySelector('input[type="checkbox"][name$="-DELETE"]');
        if (del) { del.checked = true; row.classList.add('hidden'); }
        else {
          row.remove();
          total.value = (parseInt(total.value||'0',10) - 1).toString();
        }
        renumber();
      });
    }

    document.querySelectorAll('.btn-remove').forEach(bindRemove);

    document.getElementById('addRowBtn')?.addEventListener('click', () => {
      const idx = parseInt(total.value || '0', 10);
      const html = tpl.innerHTML.replace(/__prefix__/g, idx);
      const wrap = document.createElement('div');
      wrap.innerHTML = html.trim();
      const row = wrap.firstElementChild;
      rows.appendChild(row);
      total.value = idx + 1;
      bindRemove(row.querySelector('.btn-remove'));
      renumber();
      row.querySelector('select[name$="-exercise"], input[name$="-exercise"]')?.focus();
    });
  })();
</script>
{% endblock %}