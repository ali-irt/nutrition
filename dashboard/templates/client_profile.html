{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
    * {
        font-family: 'Inter', sans-serif;
    }

    body {
        background: #f8f9fa;
        margin: 0;
        padding: 0;
    }

    /* Client Header Section */
    .client-header-section {
        background: #000;
        color: white;
        padding: 32px 0 0;
        margin-left: -20px;
        margin-right: -20px;
        margin-top: 40px;
    }

    .client-header-content {
        margin: 0 auto;
        padding: 0 40px;
    }

    .client-profile-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 24px;
    }

    .client-profile-info {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .client-avatar-large {
        width: 80px;
        height: 80px;
        background-color: white;
        color: #1a1a1a;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        font-weight: 700;
        text-transform: uppercase;
    }

    .client-name-section h1 {
        font-size: 32px;
        font-weight: 600;
        margin: 0 0 8px 0;
    }

    .demo-badge {
        background-color: white;
        color: #1a1a1a;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
    }

    .client-actions {
        display: flex;
        gap: 12px;
    }

    .action-icon {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        font-size: 18px;
        width: 40px;
        height: 40px;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .action-icon:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }

    /* Navigation Tabs */
    .client-nav-tabs {
        display: flex;
        gap: 32px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .client-nav-tabs a {
        color: #999;
        text-decoration: none;
        font-size: 15px;
        font-weight: 500;
        padding: 12px 0;
        border-bottom: 2px solid transparent;
        transition: all 0.2s ease;
        position: relative;
        top: 1px;
    }

    .client-nav-tabs a:hover {
        color: #ccc;
    }

    .client-nav-tabs a.active {
        color: white;
        border-bottom-color: white;
    }

    /* Main Content */
    .main-content {
        margin: 0 auto;
        padding: 32px 40px;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }

    .section-title {
        font-size: 24px;
        font-weight: 600;
        color: #1a1a1a;
        margin: 0;
    }

    /* Tab Content Areas */
    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    /* Overview Tab Styles */
    .overview-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
        margin-bottom: 32px;
    }

    .main-card {
        background: white;
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .main-card h2 {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
        color: #1a1a1a;
    }

    .main-card p {
        color: #666;
        margin-bottom: 24px;
    }

    .membership-box {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
    }

    .membership-box h3 {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .progress-bar-container {
        height: 8px;
        background: #e9ecef;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 16px;
    }

    .progress-bar-fill {
        height: 100%;
        background: #1a1a1a;
        border-radius: 4px;
        transition: width 0.3s ease;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
    }

    .stat-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .stat-label {
        font-size: 13px;
        color: #666;
        margin-bottom: 8px;
    }

    .stat-value {
        font-size: 28px;
        font-weight: 700;
        color: #1a1a1a;
        margin-bottom: 4px;
    }

    .stat-subtitle {
        font-size: 13px;
        color: #999;
    }

    .stat-bar {
        height: 6px;
        background: #1a1a1a;
        border-radius: 3px;
        margin-top: 16px;
    }

    /* Expandable Sections */
    .expandable-sections {
        margin-top: 32px;
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .expandable-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .expandable-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .expandable-header:hover {
        background: #f8f9fa;
    }

    .expandable-title {
        font-size: 16px;
        font-weight: 600;
        color: #1a1a1a;
    }

    .expandable-subtitle {
        font-size: 14px;
        color: #666;
    }

    .expandable-icon {
        font-size: 20px;
        transition: transform 0.3s ease;
    }

    .expandable-card.open .expandable-icon {
        transform: rotate(180deg);
    }

    .expandable-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
    }

    .expandable-content.open {
        max-height: 500px;
    }

    .expandable-body {
        padding: 0 24px 24px;
        color: #666;
    }

    /* Meal Sections */
    .meal-sections {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .meal-section {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .meal-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 16px;
    }

    .meal-title {
        font-size: 20px;
        font-weight: 600;
        color: #1a1a1a;
        margin: 0 0 4px 0;
    }

    .meal-subtitle {
        font-size: 14px;
        color: #666;
        margin: 0;
    }

    .meal-nutrition {
        text-align: right;
    }

    .meal-calories-number {
        font-size: 24px;
        font-weight: 700;
        color: #1a1a1a;
        margin: 0 0 8px 0;
    }

    .meal-macros {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .macro-line {
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: flex-end;
    }

    .macro-name {
        font-weight: 600;
    }

    .macro-name.protein {
        color: #e91e63;
    }

    .macro-name.carbs {
        color: #20c997;
    }

    .macro-name.fat {
        color: #9c27b0;
    }

    /* Workout Table */
    .workout-table-container {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .workout-table {
        width: 100%;
        border-collapse: collapse;
    }

    .workout-table thead {
        background: #f8f9fa;
    }

    .workout-table th {
        padding: 16px;
        text-align: left;
        font-size: 14px;
        font-weight: 600;
        color: #666;
        border-bottom: 1px solid #e9ecef;
    }

    .workout-table td {
        padding: 16px;
        border-bottom: 1px solid #f0f0f0;
    }

    .workout-table tbody tr:hover {
        background: #f8f9fa;
    }

    .workout-thumb {
        width: 60px;
        height: 60px;
        border-radius: 10px;
        object-fit: cover;
    }

    .workout-thumb-placeholder {
        width: 60px;
        height: 60px;
        background: #e9ecef;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        color: #999;
    }

    /* Progress */
    .progress-entries {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .progress-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .progress-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid #f0f0f0;
    }

    .progress-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
    }

    .metric-item {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
    }

    /* Membership */
    .membership-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
    }

    .membership-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .status-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 500;
    }

    .status-badge.active {
        background: #d4edda;
        color: #155724;
    }

    .status-badge.inactive {
        background: #f8d7da;
        color: #721c24;
    }

    /* Empty States */
    .empty-state {
        background: white;
        border-radius: 16px;
        padding: 60px 24px;
        text-align: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }

    .empty-state-text {
        font-size: 16px;
        color: #999;
    }

    /* Buttons */
    .btn-primary {
        background: #1a1a1a;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .btn-primary:hover {
        background: #333;
    }

    /* Responsive */
    @media (max-width: 1024px) {
        .overview-grid {
            grid-template-columns: 1fr;
        }

        .client-header-content {
            padding: 0 20px;
        }

        .main-content {
            padding: 24px 20px;
        }
    }

    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: 1fr;
        }

        .client-profile-row {
            flex-direction: column;
            align-items: flex-start;
            gap: 16px;
        }

        .client-nav-tabs {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .meal-header {
            flex-direction: column;
            gap: 12px;
        }

        .meal-nutrition {
            text-align: left;
        }
    }

    /* Secondary button */
    .btn-secondary {
        background: #fff;
        color: #1a1a1a;
        border: 1px solid #e5e7eb;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: background-color 0.2s ease;
    }

    .btn-secondary:hover {
        background: #f8fafc;
    }

    /* Modal base */
    .modal {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 24px;
        z-index: 1000;
    }

    .modal[aria-hidden="false"] {
        display: flex;
    }

    .modal__backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, .45);
    }

    .modal__dialog {
        position: relative;
        background: #fff;
        width: min(720px, 92vw);
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, .15);
        display: flex;
        flex-direction: column;
        max-height: min(82vh, 900px);
    }

    .modal__header {
        padding: 18px 20px;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
    }

    .modal__title {
        font-size: 18px;
        font-weight: 600;
    }

    .modal__close {
        background: transparent;
        border: none;
        font-size: 22px;
        line-height: 1;
        cursor: pointer;
        padding: 6px;
        color: #6b7280;
    }

    .modal__body {
        padding: 16px 20px;
        overflow: auto;
    }

    .modal__footer {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
        padding: 14px 20px;
        border-top: 1px solid #e9ecef;
    }

    /* Inputs in modals */
    input[type="search"],
    input[type="text"],
    textarea,
    select,
    input[type="file"] {
        width: 100%;
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 14px;
    }

    /* Lists (documents + library) */
    .doc-list {
        list-style: none;
        margin: 12px 0 0;
        padding: 0;
        display: grid;
        gap: 8px;
    }

    .doc-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        padding: 10px 12px;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        background: #fff;
    }

    .doc-item small {
        color: #666;
    }

    .list {
        display: grid;
        gap: 8px;
        margin-top: 10px;
    }

    .list-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        padding: 10px 12px;
        cursor: pointer;
        background: #fff;
    }

    .list-item[aria-selected="true"] {
        border-color: #111;
        outline: 2px solid #111;
    }

    .file-pill {
        padding: 2px 8px;
        border: 1px solid #e5e7eb;
        border-radius: 999px;
        font-size: 12px;
        color: #666;
    }

    .text-muted {
        color: #666;
    }

    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }
</style>
{% endblock %}

{% block content %}
<section style="margin-left: -40px;    margin-right: -40px; margin-top: 10px;" class="bg-black text-white " >

<div class="client-detail-container">
    <!-- Client Header -->
    <div class="client-header-section">
        <div class="client-header-content">
            <div class="client-profile-row">
                <div style="padding-left: 2in;" class="client-profile-info">
                    <div class="client-avatar-large">
                        {{ client.first_name|default:client.username|slice:":2"|upper }}
                    </div>
                    <div class="client-name-section">
                        <h1>
                            {% if client.first_name or client.last_name %}
                            {{ client.first_name }} {{ client.last_name }}
                            {% else %}
                            {{ client.username }}
                            {% endif %}
                        </h1>
                        <div class="demo-badge">
                            📅 Joined {{ client.date_joined|date:"M d, Y" }}
                        </div>
                    </div>
                </div>
                <div class="client-actions">
                    <button class="action-icon" title="Messages">💬</button>
                    <button class="action-icon" title="Notifications">🔔</button>
                    <button class="action-icon" title="More">⋮</button>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div style="padding-left: 2in ;" class="client-nav-tabs">
                <a href="?tab=overview" class="text-decoration-none {% if current_tab == 'overview' %} fw-bold text-light {% else %}text-secondary{% endif %}">Overview</a>
                <a href="?tab=nutrition" class="text-decoration-none {% if current_tab == 'nutrition' %} fw-bold text-light {% else %}text-secondary{% endif %}">Nutrition</a>
                <a href="?tab=workout" class="text-decoration-none {% if current_tab == 'workout' %} fw-bold text-light {% else %}text-secondary{% endif %}">Workouts</a>
                <a href="?tab=progress" class="text-decoration-none {% if current_tab == 'progress' %} fw-bold text-light {% else %}text-secondary{% endif %}">Progress</a>
                <a href="?tab=membership" class="text-decoration-none {% if current_tab == 'membership' %} fw-bold text-light {% else %}text-secondary{% endif %}">Membership</a>
            </div>
        </div>
    </div>
</section>

    <!-- Main Content -->
    <div class="main-content">

        <!-- OVERVIEW TAB -->
        <div class="tab-content {% if current_tab == 'overview' %}active{% endif %}" id="overview-tab">
            <div class="overview-grid">
                <!-- Left Column -->
                <div class="main-card">
                    <h2>Great! {{ client.first_name|default:client.username }} has a new check-in</h2>
                    <p>{{ client.email|default:"No preferences specified" }}</p>

                    <div class="membership-box">
                        <h3>Membership: Free for 3 months</h3>
                        <p style="color: #666; margin-bottom: 0;">Free with active app</p>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill" style="width: 60%;"></div>
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; font-size: 14px; color: #666;">
                        <span>0 unread messages</span>
                        <span>1 task</span>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Weight</div>
                        <div class="stat-value">
                            {% if progress %}
                            {{ progress.first.weight|default:"—" }}
                            <span style="font-size: 16px; color: #666;">kg</span>
                            {% else %}
                            —
                            {% endif %}
                        </div>
                        <div class="stat-subtitle">
                            {% if progress %}Lost {{ progress.first.weight_change|default:"0" }} kg{% else %}No data
                            yet{% endif %}
                        </div>
                        <div class="stat-bar"></div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Check-in</div>
                        <div class="stat-value">None</div>
                        <div class="stat-subtitle">No check-in day</div>
                        <div class="stat-bar"></div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Nutrition plan</div>
                        <div class="stat-value">
                            {% if meals %}
                            {{ meals.first.calories|default:"0" }}
                            {% else %}
                            0
                            {% endif %}
                        </div>
                        <div class="stat-subtitle">
                            {% if meals %}Calories | {{ meals.count }} meals/day{% else %}No plan assigned{% endif %}
                        </div>
                        <div class="stat-bar"></div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-label">Training</div>
                        <div class="stat-value">
                            {% if workouts %}{{ workouts.count }}{% else %}No{% endif %}
                        </div>
                        <div class="stat-subtitle">Sessions tracked last week</div>
                        <div class="stat-bar"></div>
                    </div>
                </div>
            </div>

            <!-- Expandable Sections -->
            <div class="expandable-sections">
                <div class="expandable-card">
                    <div class="expandable-header" onclick="toggleExpand(this)">
                        <div>
                            <div class="expandable-title">📄 Documents</div>
                        </div>
                        <div class="expandable-icon">▼</div>
                    </div>
                    <div class="expandable-content">
                        <div class="expandable-body">
                            <p id="documents-empty" class="text-muted">No documents have been uploaded yet. Add
                                contracts, forms, or other important files here.</p>
                            <ul id="doc-list" class="doc-list"></ul>
                            <div style="display:flex; gap:8px; margin-top:12px;">
                                <button class="btn-secondary" data-open="modal-add-pdf">Add from library</button>
                                <button class="btn-primary" data-open="modal-upload">Upload Document</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="expandable-card">
                    <div class="expandable-header" onclick="toggleExpand(this)">
                        <div>
                            <div class="expandable-title">📚 Lessons</div>
                            <div class="expandable-subtitle">0 Lessons sent, 0 scheduled</div>
                        </div>
                        <div class="expandable-icon">▼</div>
                    </div>
                    <div class="expandable-content">
                        <div class="expandable-body">
                            <p>Create and send educational content, workout tutorials, or nutrition guides to your
                                client.</p>
                            <button class="btn-primary" data-open="modal-create-lesson" style="margin-top: 12px;">Create
                                Lesson</button>
                        </div>
                    </div>
                </div>

                <div class="expandable-card">
                    <div class="expandable-header" onclick="toggleExpand(this)">
                        <div>
                            <div class="expandable-title">📧 Email & Publishing History</div>
                            <div class="expandable-subtitle">No records available</div>
                        </div>
                        <div class="expandable-icon">▼</div>
                    </div>
                    <div class="expandable-content">
                        <div class="expandable-body">
                            <p>View all emails sent to this client and track when plans were published or updated.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NUTRITION TAB -->
        <div class="tab-content {% if current_tab == 'nutrition' %}active{% endif %}" id="nutrition-tab">
            <div class="section-header">
                <h2 class="section-title">Meal Plan</h2>
                <button class="btn-primary">+ Add Meal</button>
            </div>

            {% if meals %}
            <div class="meal-sections">
                {% for meal in meals %}
                <div class="meal-section">
                    <div class="meal-header">
                        <div>
                            <h3 class="meal-title">{{ meal.meal_type|title }}</h3>
                            <p class="meal-subtitle">{{ meal.description|default:"No description" }}</p>
                        </div>
                        <div class="meal-nutrition">
                            <p class="meal-calories-number">{{ meal.calories|default:"—" }} kcal</p>
                            <div class="meal-macros">
                                <div class="macro-line">
                                    <span class="macro-name protein">Protein:</span>
                                    <span>{{ meal.protein|default:"0" }}g</span>
                                </div>
                                <div class="macro-line">
                                    <span class="macro-name carbs">Carbs:</span>
                                    <span>{{ meal.carbs|default:"0" }}g</span>
                                </div>
                                <div class="macro-line">
                                    <span class="macro-name fat">Fat:</span>
                                    <span>{{ meal.fat|default:"0" }}g</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">🍽️</div>
                <p class="empty-state-text">No meals assigned to this client yet</p>
            </div>
            {% endif %}
        </div>

        <!-- WORKOUT TAB -->
        <div class="tab-content {% if current_tab == 'workout' %}active{% endif %}" id="workout-tab">
            <div class="section-header">
                <h2 class="section-title">Workout Plans</h2>
                <button class="btn-primary">+ Add Workout</button>
            </div>

            {% if workouts %}
            <div class="workout-table-container">
                <table class="workout-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Sessions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for workout in workouts %}
                        <tr>
                            <td>
                                {% if workout.image %}
                                <img src="{{ workout.image.url }}" class="workout-thumb" alt="{{ workout.name }}">
                                {% else %}
                                <div class="workout-thumb-placeholder">No Image</div>
                                {% endif %}
                            </td>
                            <td><strong>{{ workout.name }}</strong></td>
                            <td>{{ workout.type|default:"—" }}</td>
                            <td>
                                <span class="status-badge active">Active</span>
                            </td>
                            <td>{{ workout.sessions_count|default:"0" }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">🏋️</div>
                <p class="empty-state-text">No workout plans assigned yet</p>
            </div>
            {% endif %}
        </div>

        <!-- PROGRESS TAB -->
        <div class="tab-content {% if current_tab == 'progress' %}active{% endif %}" id="progress-tab">
            <div class="section-header">
                <h2 class="section-title">Progress Tracking</h2>
                <button class="btn-primary">+ Log Progress</button>
            </div>

            {% if progress %}
            <div class="progress-entries">
                {% for entry in progress %}
                <div class="progress-card">
                    <div class="progress-card-header">
                        <h3 style="font-size: 18px; font-weight: 600;">📊 {{ entry.date|date:"F j, Y" }}</h3>
                        <p style="color: #666;">Weight: {{ entry.weight }} kg</p>
                    </div>
                    <div class="progress-metrics">
                        <div class="metric-item">
                            <span style="color: #666;">Body Fat %</span>
                            <span style="font-weight: 600;">{{ entry.body_fat_percentage|default:"—" }}%</span>
                        </div>
                        <div class="metric-item">
                            <span style="color: #666;">BMI</span>
                            <span style="font-weight: 600;">{{ entry.bmi|default:"—" }}</span>
                        </div>
                        <div class="metric-item">
                            <span style="color: #666;">Chest</span>
                            <span style="font-weight: 600;">{{ entry.chest|default:"—" }} cm</span>
                        </div>
                        <div class="metric-item">
                            <span style="color: #666;">Waist</span>
                            <span style="font-weight: 600;">{{ entry.waist|default:"—" }} cm</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">📈</div>
                <p class="empty-state-text">No progress entries recorded yet</p>
            </div>
            {% endif %}
        </div>

        <!-- MEMBERSHIP TAB -->
        <div class="tab-content {% if current_tab == 'membership' %}active{% endif %}" id="membership-tab">
            <div class="section-header">
                <h2 class="section-title">Membership Details</h2>
                <button class="btn-primary">+ Add Membership</button>
            </div>

            {% if memberships %}
            <div class="membership-grid">
                {% for membership in memberships %}
                <div class="membership-card">
                    <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 8px;">{{
                        membership.plan_name|default:"Custom Plan" }}</h3>
                    <p style="color: #666; margin-bottom: 16px;">Duration: {{ membership.duration|default:"N/A" }}</p>
                    <div style="margin: 16px 0;">
                        <span class="status-badge {% if membership.is_active %}active{% else %}inactive{% endif %}">
                            {% if membership.is_active %}Active{% else %}Inactive{% endif %}
                        </span>
                    </div>
                    <div style="padding: 12px 0; border-top: 1px solid #f0f0f0;">
                        <p style="font-size: 14px; color: #666;">Amount: <strong>{{ membership.amount|default:"0" }}
                                PKR</strong></p>
                        <p style="font-size: 14px; color: #666;">Started: {{ membership.created_at|date:"M d, Y" }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="empty-state">
                <div class="empty-state-icon">💳</div>
                <p class="empty-state-text">No membership records found</p>
            </div>
            {% endif %}
        </div>

    </div>
</div>
<!-- Modal: Add PDF from library -->
<div class="modal" id="modal-add-pdf" aria-hidden="true" role="dialog" aria-modal="true"
    aria-labelledby="title-add-pdf">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog" role="document">
        <div class="modal__header">
            <div class="modal__title" id="title-add-pdf">Add PDF from library</div>
            <button class="modal__close" aria-label="Close" data-close>&times;</button>
        </div>
        <div class="modal__body">
            <label class="sr-only" for="library-search">Search</label>
            <input id="library-search" data-autofocus type="search" placeholder="Search" />
            <div id="library-list" class="list" role="listbox" aria-label="PDF library"></div>
        </div>
        <div class="modal__footer">
            <button class="btn-secondary" data-close>Cancel</button>
            <button class="btn-primary" id="btn-add-from-library" disabled>Add</button>
        </div>
    </div>
</div>

<!-- Modal: Upload PDF -->
<div class="modal" id="modal-upload" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="title-upload">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog" role="document">
        <div class="modal__header">
            <div class="modal__title" id="title-upload">Upload PDF</div>
            <button class="modal__close" aria-label="Close" data-close>&times;</button>
        </div>
        <div class="modal__body">
            <input id="upload-file" data-autofocus type="file" accept="application/pdf" />
            <p class="text-muted" style="margin-top:10px">Accepted file type: PDF</p>
        </div>
        <div class="modal__footer">
            <button class="btn-secondary" data-close>Cancel</button>
            <button class="btn-primary" id="btn-upload" disabled>Upload</button>
        </div>
    </div>
</div>

<!-- Modal: Create Lesson -->
<div class="modal" id="modal-create-lesson" aria-hidden="true" role="dialog" aria-modal="true"
    aria-labelledby="title-create-lesson">
    <div class="modal__backdrop" data-close></div>
    <div class="modal__dialog" role="document">
        <div class="modal__header">
            <div class="modal__title" id="title-create-lesson">Create Lesson</div>
            <button class="modal__close" aria-label="Close" data-close>&times;</button>
        </div>
        <div class="modal__body">
            <label for="lesson-title" class="sr-only">Title</label>
            <input id="lesson-title" data-autofocus type="text" placeholder="Lesson title" />
            <label for="lesson-desc" class="sr-only">Description</label>
            <textarea id="lesson-desc" rows="5" placeholder="Short description or outline"
                style="margin-top:10px"></textarea>
        </div>
        <div class="modal__footer">
            <button class="btn-secondary" data-close>Cancel</button>
            <button class="btn-primary">Save</button>
        </div>
    </div>
</div>
<script>
    // Tab switching
    document.addEventListener('DOMContentLoaded', function () {
        const tabLinks = document.querySelectorAll('.client-nav-tabs a');

        tabLinks.forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();

                // Remove active from all links
                tabLinks.forEach(l => l.classList.remove('active'));

                // Add active to clicked link
                this.classList.add('active');

                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                // Show selected tab
                const tabParam = new URLSearchParams(this.search).get('tab');
                const tabContent = document.getElementById(tabParam + '-tab');
                if (tabContent) {
                    tabContent.classList.add('active');
                }

                // Update URL without reload
                const url = new URL(window.location);
                url.searchParams.set('tab', tabParam);
                window.history.pushState({}, '', url);
            });
        });
    });

    // Toggle expandable sections
    function toggleExpand(header) {
        const card = header.parentElement;
        const content = card.querySelector('.expandable-content');

        card.classList.toggle('open');
        content.classList.toggle('open');
    }
</script>
<script>
    (() => {
        let activeModal = null;
        let prevFocus = null;

        function openModal(id) {
            const modal = document.getElementById(id);
            if (!modal) return;
            prevFocus = document.activeElement;
            modal.setAttribute('aria-hidden', 'false');
            document.body.style.overflow = 'hidden';
            activeModal = modal;

            const focusTarget = modal.querySelector('[data-autofocus]') ||
                modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            focusTarget && focusTarget.focus();
        }

        function closeModal() {
            if (!activeModal) return;
            activeModal.setAttribute('aria-hidden', 'true');
            document.body.style.overflow = '';
            prevFocus && prevFocus.focus();
            activeModal = null;
        }

        // Open/close triggers
        document.addEventListener('click', (e) => {
            const opener = e.target.closest('[data-open]');
            if (opener) {
                e.preventDefault();
                openModal(opener.dataset.open);
            }
            if (e.target.closest('[data-close]') || e.target.classList.contains('modal__backdrop')) {
                closeModal();
            }
        });

        // ESC + focus trap
        document.addEventListener('keydown', (e) => {
            if (!activeModal) return;
            if (e.key === 'Escape') { e.preventDefault(); closeModal(); }
            if (e.key === 'Tab') {
                const focusables = activeModal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                const list = Array.from(focusables).filter(el => !el.disabled && el.offsetParent !== null);
                if (!list.length) return;
                const first = list[0], last = list[list.length - 1];
                if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
                else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
            }
        });

        // Demo library data (replace with your Django data if available)
        const LIBRARY = window.PDF_LIBRARY || [
            { id: 'lib-1', name: 'Client Welcome Pack.pdf', size: '340 KB' },
            { id: 'lib-2', name: 'Nutrition Guide v2.pdf', size: '1.1 MB' },
            { id: 'lib-3', name: 'Training Waiver.pdf', size: '220 KB' },
        ];

        const libraryList = document.getElementById('library-list');
        const addBtn = document.getElementById('btn-add-from-library');
        const searchInput = document.getElementById('library-search');

        let selectedId = null;
        function renderLibrary(items) {
            if (!libraryList) return;
            libraryList.innerHTML = '';
            if (!items.length) {
                libraryList.innerHTML = '<div class="text-muted">No results</div>';
                addBtn && (addBtn.disabled = true);
                return;
            }
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.setAttribute('role', 'option');
                div.setAttribute('data-id', item.id);
                div.setAttribute('aria-selected', String(item.id === selectedId));
                div.innerHTML = `
        <div style="flex:1 1 auto">
          <div style="font-weight:500">${item.name}</div>
          <div class="text-muted" style="font-size:12px">${item.size}</div>
        </div>
        <span class="file-pill">PDF</span>`;
                div.addEventListener('click', () => {
                    selectedId = item.id;
                    [...libraryList.children].forEach(c => c.setAttribute('aria-selected', 'false'));
                    div.setAttribute('aria-selected', 'true');
                    addBtn && (addBtn.disabled = false);
                });
                libraryList.appendChild(div);
            });
        }
        renderLibrary(LIBRARY);
        searchInput && searchInput.addEventListener('input', () => {
            const q = searchInput.value.trim().toLowerCase();
            renderLibrary(LIBRARY.filter(x => x.name.toLowerCase().includes(q)));
        });

        // Upload modal behavior
        const fileInput = document.getElementById('upload-file');
        const uploadBtn = document.getElementById('btn-upload');
        fileInput && fileInput.addEventListener('change', () => {
            uploadBtn && (uploadBtn.disabled = !(fileInput.files && fileInput.files.length));
        });

        // Documents list in-page
        const docList = document.getElementById('doc-list');
        const emptyDocs = document.getElementById('documents-empty');
        function addDocToPage({ name, size }) {
            if (!docList) return;
            const li = document.createElement('li');
            li.className = 'doc-item';
            li.innerHTML = `
      <span>${name} <small>(${size || 'PDF'})</small></span>
      <button class="btn-secondary" title="Remove">Remove</button>`;
            li.querySelector('button').addEventListener('click', () => {
                li.remove();
                if (!docList.children.length && emptyDocs) emptyDocs.style.display = '';
            });
            docList.appendChild(li);
            if (emptyDocs) emptyDocs.style.display = 'none';
        }

        // Modal action buttons
        addBtn && addBtn.addEventListener('click', () => {
            const item = LIBRARY.find(x => x.id === selectedId);
            if (item) addDocToPage(item);
            selectedId = null;
            addBtn.disabled = true;
            searchInput && (searchInput.value = '');
            renderLibrary(LIBRARY);
            closeModal();
        });

        uploadBtn && uploadBtn.addEventListener('click', () => {
            const file = fileInput.files && fileInput.files[0];
            if (!file) return;
            addDocToPage({ name: file.name, size: `${Math.ceil(file.size / 1024)} KB` });
            fileInput.value = '';
            uploadBtn.disabled = true;
            closeModal();
        });
    })();
</script>
{% endblock %}