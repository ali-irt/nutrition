{% extends "base.html" %}
{% load static %}

{% block title %}{{ client.user.get_full_name }} - Overview | The Nutri Co.{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'dashboard/css/client_profile.css' %}">
{% endblock %}

{% block content %}
<div class="client-header">
    <div class="client-info">
        <div class="client-avatar">
            {{ client.user.first_name|slice:":1" }}{{ client.user.last_name|slice:":1" }}
        </div>
        <div>
            <h1 class="client-name">{{ client.user.get_full_name }}</h1>
            <div class="client-tabs">
                <a href="{% url 'client_profile' client.user.id %}">Overview</a>
                <a href="{% url 'client_nutrition' client.user.id %}">Nutrition</a>
                <a href="{% url 'client_workout' client.user.id %}">Workouts</a>
                <a href="{% url 'client_progress' client.user.id %}">Progress</a>
                <a href="{% url 'client_membership' client.user.id %}">Membership</a>
            </div>
        </div>
    </div>
    <div class="header-actions">
        <button class="icon-btn">‚äô</button>
        <button class="icon-btn">üí¨</button>
        <button class="icon-btn">‚áÑ</button>
    </div>
</div>

<main class="main-content">

    <section class="client-setting">
        <div class="section-header">
            <span>Client Settings</span>
            <span>‚ÑπÔ∏è</span>
        </div>

        <h2 class="section-title">
            Great! {{ client.user.first_name }} has a new check-in
        </h2>
        <p class="section-subtitle">
            {% if client.bio %}{{ client.bio }}{% else %}No preferences specified{% endif %}
        </p>

        <!-- Membership Info -->
        <div class="membership-card">
            <div class="membership-text">
                Membership: 
                <span class="membership-duration">
                    {{ client.membership_type|default:"Free" }}
                </span>
            </div>
            <span class="stat-icon">üîÑ</span>
        </div>

        <!-- Progress -->
        <div class="progress-section">
            {% if progress %}
                {% with latest=progress.first %}
                    <div class="progress-title">Progress Status</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ latest.weight_change|default:0 }}%;"></div>
                    </div>
                    <div class="progress-label">
                        Latest: {{ latest.date|date:"M d, Y" }}
                    </div>
                {% endwith %}
            {% else %}
                <p>No progress data yet.</p>
            {% endif %}
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <!-- Weight -->
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Weight</span>
                    <span class="stat-icon">‚öñÔ∏è</span>
                </div>
                {% with latest=progress.first %}
                    <div class="stat-row">
                        <span>Start</span>
                        <span class="stat-value">{{ latest.start_weight|default:"‚Äî" }} <span class="stat-unit">kg</span></span>
                    </div>
                    <div class="stat-row">
                        <span>Goal</span>
                        <span class="stat-value">{{ latest.goal_weight|default:"‚Äî" }} <span class="stat-unit">kg</span></span>
                    </div>
                    <div class="stat-row">
                        <span>Change</span>
                        <span class="stat-value">{{ latest.weight_change|default:"‚Äî" }} <span class="stat-unit">kg</span></span>
                    </div>
                {% endwith %}
            </div>

            <!-- Nutrition -->
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Nutrition</span>
                    <span class="stat-icon">ü•ó</span>
                </div>
                {% if meals  %}
                    {% with meal=meals.first %}
                        <div class="stat-row">
                            <span>Protein</span>
                            <span class="stat-value">{{ meal.total_protein|default:0 }} g</span>
                        </div>
                        <div class="stat-row">
                            <span>Carbs</span>
                            <span class="stat-value">{{ meal.total_carbs|default:0 }} g</span>
                        </div>
                        <div class="stat-row">
                            <span>Fat</span>
                            <span class="stat-value">{{ meal.total_fat|default:0 }} g</span>
                        </div>
                    {% endwith %}
                {% else %}
                    <p>No nutrition data yet.</p>
                {% endif %}
            </div>

            <!-- Training -->
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-label">Training</span>
                    <span class="stat-icon">üí™</span>
                </div>
                {% if workout_logs %}
                    {% with latest_log=workout_logs.first %}
                        <div class="stat-row">
                            <span>Last Workout</span>
                            <span class="stat-value">{{ latest_log.workout.name }}</span>
                        </div>
                        <div class="stat-row">
                            <span>Duration</span>
                            <span class="stat-value">{{ latest_log.duration_minutes|default:0 }} min</span>
                        </div>
                        <div class="stat-row">
                            <span>Calories</span>
                            <span class="stat-value">{{ latest_log.calories_burned|default:0 }}</span>
                        </div>
                    {% endwith %}
                {% else %}
                    <p>No workouts logged yet.</p>
                {% endif %}
            </div>
        </div>

        <!-- Wishlist -->
        <div class="wishlist-section">
            <h3>Wishlist</h3>
            {% if wishlist %}
                <ul>
                    {% for item in wishlist %}
                        <li>{{ item.name }} (Priority: {{ item.priority }})</li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No wishlist items.</p>
            {% endif %}
        </div>
    </section>
</main>
{% endblock %}
